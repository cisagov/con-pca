<div class="container-fluid" [style.height.px]="body_content_height">
  <div class="row h-100">
    <div class="col-4 border-right h-100 p-3 flex-container flex-column">
      <mat-form-field class="w-100 pb-3" appearance="outline">
        <mat-label>Search</mat-label>
        <input [(ngModel)]="search_input" matInput />
      </mat-form-field>
      <mat-list class="overflow-auto flex-1 template-list" appearnce="outline">
        <h3 matSubheader>(Deception Score) : Template Name</h3>
        <mat-list-item #templateList
          *ngFor="
            let template of template_list
              | listfilter
                : 'name,descriptive_words,deception_score'
                : search_input
          "
        >
          <button
            mat-button
            class="w-100 text-left"
            (click)="selectTemplate(template.template_uuid)"
          >
            ({{ template.deception_score }}) : {{ template.name }}
          </button>
        </mat-list-item>
      </mat-list>
    </div>
    <div
      class="col-8 h-100 d-flex flex-column"
      [formGroup]="currentTemplateFormGroup"
    >
      <div
        #selectedTemplateTitle
        class="flex-container flex-row p-3 selected-template"
      >
        <mat-form-field
          class="w-100 mr-3 selected_template_title"
          appearance="outline"
        >
          <mat-label>Template Name</mat-label>
          <input
            formControlName="templateName"
            matInput
            placeholder="Enter a template name"
            [errorStateMatcher]="matchTemplateName"
          />
          <mat-error
            *ngIf="
              currentTemplateFormGroup.controls.templateName.hasError(
                'required'
              )
            "
          >
            Template name <strong>required</strong>
          </mat-error>
        </mat-form-field>
        <button
          [disabled]="
            currentTemplateFormGroup.controls.templateUUID.value == null
          "
          [routerLink]="[
            '/deceptioncalculator',
            currentTemplateFormGroup.controls.templateUUID.value
          ]"
          mat-raised-button
          color="primary"
        >
          Deception Calculator
        </button>
      </div>
      <div class="d-flex">
        <mat-tab-group
          class="w-100"
          #tabs
          (selectedTabChange)="onTabChanged($event)"
        >
          <!-- <mat-tab label="HTML View" class="mb-3"> -->
          <mat-tab>
            <ng-template mat-tab-label>
              <span
                [ngClass]="{
                  'tab-form-error':
                    currentTemplateFormGroup.controls.templateHTML.hasError(
                      'required'
                    ) && currentTemplateFormGroup.controls.templateHTML.touched
                }"
                >HTML View
              </span>
            </ng-template>
            <div>
              <angular-editor
                #angularEditor
                [style.height.px]="text_editor_height"
                formControlName="templateHTML"
                [config]="editorConfig"
              ></angular-editor>
            </div>
          </mat-tab>
          <mat-tab>
            <ng-template mat-tab-label>
              <span
                [ngClass]="{
                  'tab-form-error':
                    currentTemplateFormGroup.controls.templateHTML.hasError(
                      'required'
                    ) && currentTemplateFormGroup.controls.templateHTML.touched
                }"
                >Source View
              </span>
            </ng-template>
            <div class="d-flex flex-column mt-2">
              <mat-form-field class="flex-grow-1">
                <mat-label>Template HTML content</mat-label>
                <textarea
                  [style.height.px]="text_editor_height"
                  [style.margin-bottom.px]="text_area_bot_marg"
                  matInput
                  formControlName="templateHTML"
                  [value]="currentTemplateFormGroup.value.templateHTML"
                  placeholder="Select a template on the left to edit"
                  class="flex-1"
                  style="resize: none;"
                ></textarea>
              </mat-form-field>
            </div>
          </mat-tab>
          <!-- <mat-tab label="Template Attributes"
          [ngClass]="{'testing' : currentTemplateFormGroup.controls.templateFromAddress.hasError('required')}"
          class="mb-3"> -->

          <mat-tab>
            <ng-template mat-tab-label>
              <span
                [ngClass]="{
                  'tab-form-error':
                    (currentTemplateFormGroup.controls.templateSubject.hasError(
                      'required'
                    ) &&
                      currentTemplateFormGroup.controls.templateSubject
                        .touched) ||
                    (currentTemplateFormGroup.controls.templateFromAddress.hasError(
                      'required'
                    ) &&
                      currentTemplateFormGroup.controls.templateFromAddress
                        .touched)
                }"
                >Template Attributes
              </span>
            </ng-template>
            <div
              class=" p-3 flex-column"
              [style.height.px]="text_editor_height"
            >
              <div class="d-flex flex-column pb-3">
                <mat-form-field appearance="outline">
                  <mat-label>Subject*</mat-label>
                  <input
                    type="text"
                    matInput
                    placeholder="Template Subject"
                    formControlName="templateSubject"
                    [errorStateMatcher]="matchSubject"
                  />
                  <mat-error
                    *ngIf="
                      currentTemplateFormGroup.controls.templateSubject.hasError(
                        'required'
                      )
                    "
                  >
                    Template subject <strong>required</strong>
                  </mat-error>
                </mat-form-field>
              </div>
              <div class="d-flex flex-column pb-3">
                <mat-form-field appearance="outline">
                  <mat-label>From Address*</mat-label>
                  <input
                    type="text"
                    matInput
                    placeholder="Example@user.com"
                    formControlName="templateFromAddress"
                    [errorStateMatcher]="matchFromAddress"
                  />
                  <mat-error
                    *ngIf="
                      currentTemplateFormGroup.controls.templateFromAddress.hasError(
                        'required'
                      )
                    "
                  >
                    From address <strong>required</strong>
                  </mat-error>
                </mat-form-field>
              </div>
              <div class="d-flex flex-column pb-3">
                <mat-form-field appearance="outline">
                  <mat-label>Description</mat-label>
                  <input
                    type="text"
                    matInput
                    placeholder="Template Description..."
                    formControlName="templateDescription"
                  />
                </mat-form-field>
              </div>
              <div class="d-flex flex-column mt-2">
                <mat-form-field appearance="outline" class="flex-grow-1">
                  <mat-label>Descriptive Words (CSV)</mat-label>
                  <textarea
                    matInput
                    cdkTextareaAutosize
                    cdkAutosizeMinRows="5"
                    cdkAutosizeMaxRows="10"
                    placeholder="Template Descriptive Words Seperated By A Comma"
                    formControlName="templateDescriptiveWords"
                  ></textarea>
                </mat-form-field>
              </div>
            </div>
          </mat-tab>
        </mat-tab-group>
      </div>

      <div class="flex-container flex-row save_container pb-3">
        <button
          id="save-button"
          class="d-flex"
          mat-raised-button
          color="primary"
          (click)="setEmptyTemplateForm()"
        >
          New Template
        </button>
        <button 
          id="save-button"
          class="d-flex ml-auto"
          mat-raised-button
          color="primary"
          (click)="saveTemplate()"        >
          {{templateId ? 'Update' : 'Save New'}}
        </button>
      </div>
    </div>
  </div>
</div>
